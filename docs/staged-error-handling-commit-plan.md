# Staged Error Handling Commit Plan

**Date:** 2025-11-06
**Branch:** 10-23-improve_api_error_handling_and_surface_user-facing_errors

Each entry below calls out the expected commit message, the files that belong together, and the validation to run before moving on. File groupings use glob notation when the full list is repetitive; keep incidental formatting or locale fixes with the primary change set they originated from.

| # | Suggested commit message | Include these files | Validation |
| --- | --- | --- | --- |
| 1 | `docs: capture staged error handling guidance` | `AGENTS.md`; all new/updated docs under `docs/` including `docs/error-handling-improvement-plan.md`, `docs/error-handling-plan.md`, `docs/loader-client-loader-audit.md`, `docs/loader-error-handling-plan.md`, `docs/promise-rejection-handling-audit.md`, `docs/suspense-await-loader-audit.md`, `docs/user-facing-error-review-findings.md`, `docs/staged-error-handling-audit.md`, `docs/staged-error-handling-commit-plan.md` | Spellcheck and manual doc review |
| 2 | `feat: add shared loader error utilities` | `apps/cyberstorm-remix/cyberstorm/utils/errors/handleLoaderError.ts`; `apps/cyberstorm-remix/cyberstorm/utils/errors/loaderMappings.ts`; `apps/cyberstorm-remix/cyberstorm/utils/errors/loaderResult.ts`; `apps/cyberstorm-remix/cyberstorm/utils/errors/resolveRouteErrorPayload.ts`; `apps/cyberstorm-remix/cyberstorm/utils/errors/userFacingErrorResponse.ts`; corresponding tests in `apps/cyberstorm-remix/cyberstorm/utils/errors/__tests__/*.test.ts`; `apps/cyberstorm-remix/cyberstorm/utils/StrongForm/useStrongForm.ts` | `pnpm vitest run apps/cyberstorm-remix/cyberstorm/utils/errors/__tests__/handleLoaderError.test.ts apps/cyberstorm-remix/cyberstorm/utils/errors/__tests__/resolveRouteErrorPayload.test.ts apps/cyberstorm-remix/cyberstorm/utils/errors/__tests__/userFacingErrorResponse.test.ts` |
| 3 | `feat: add Nimbus error boundary component` | `apps/cyberstorm-remix/app/commonComponents/NimbusErrorBoundary/NimbusErrorBoundary.tsx`; `apps/cyberstorm-remix/app/commonComponents/NimbusErrorBoundary/NimbusErrorBoundary.css`; `apps/cyberstorm-remix/app/commonComponents/NimbusErrorBoundary/index.ts` | `pnpm lint` (component directory) |
| 4 | `feat: wire Nimbus boundary into Remix shell` | `apps/cyberstorm-remix/app/root.tsx`; any supporting layout/style adjustments in `apps/cyberstorm-remix/app/commonComponents/**` (e.g., `PackageSearch` changes) | `pnpm vitest run apps/cyberstorm-remix/cyberstorm/utils/errors/__tests__/resolveRouteErrorPayload.test.ts` (sanity) + manual UI smoke |
| 5 | `feat: harden community/package routes for loader errors` | Package- and community-facing routes under `apps/cyberstorm-remix/app/p/**`; `apps/cyberstorm-remix/app/c/**`; related CSS tweaks (`Community.css`, `packageListing.css`, `Changelog.css`, `Readme.css`) | Targeted Remix smoke (navigate package + community flows) |
| 6 | `feat: update settings and upload loaders` | `apps/cyberstorm-remix/app/settings/**`; `apps/cyberstorm-remix/app/upload/upload.tsx` | Manual QA of settings/upload; consider Playwright smoke |
| 7 | `feat: expose sanitized user-facing errors in sdk` | `packages/thunderstore-api/src/errors.ts`; `packages/thunderstore-api/src/errors/userFacingError.ts`; `packages/thunderstore-api/src/errors/sanitizeServerDetail.ts`; `packages/thunderstore-api/src/apiFetch.ts`; `packages/thunderstore-api/src/index.ts`; touched `packages/thunderstore-api/src/get/**/*.ts`; new tests `packages/thunderstore-api/src/__tests__/userFacingError.test.ts` | `pnpm test --filter thunderstore-api` |
| 8 | `feat: propagate user-facing errors through react bindings` | `packages/ts-api-react/src/index.ts`; `packages/ts-api-react/src/useApiCall.ts`; `packages/ts-api-react-actions/src/ApiAction.tsx`; `packages/ts-api-react-actions/src/useApiAction.ts` | `pnpm vitest run packages/ts-api-react/src/** --runInBand` (or existing suite) |
| 9 | `feat: align dapper api surfaces with user-facing payloads` | `packages/dapper-ts/src/methods/communities.ts`; `packages/dapper-ts/src/methods/communityFilters.ts`; `packages/dapper-ts/src/methods/packageListings.ts`; `packages/dapper/src/types/shared.ts`; `packages/cyberstorm-forms/src/useFormToaster.ts` | `pnpm lint packages/dapper-ts packages/dapper packages/cyberstorm-forms` |
| 10 | `refactor: polish package search scaffolding` | Remaining shared component adjustments such as `apps/cyberstorm-remix/app/commonComponents/PackageSearch/**` and `apps/cyberstorm-remix/app/commonComponents/PaginatedDependencies/PaginatedDependencies.tsx` not already captured above | `pnpm lint` |

> Tip: If any optional formatting-only edits remain after grouping, squash them into the most relevant feature commit to avoid noise.
